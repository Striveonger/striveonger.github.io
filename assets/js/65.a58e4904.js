(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{545:function(s,a,t){s.exports=t.p+"assets/img/image-20250509172716850.1c44fac4.png"},781:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("书接上回,  上次咱们将 "),a("code",[s._v("own-open-apis")]),s._v(" 项目, 并接入"),a("code",[s._v("kubernetes")]),s._v(" 的环境中. 今天我们就为实验"),a("code",[s._v("Pod")]),s._v("调度, 来准备测试环境....")]),s._v(" "),a("p",[s._v("闲言少叙, 开始正文")]),s._v(" "),a("p",[s._v("我准备了三台虚拟机,  系统都是 "),a("code",[s._v("Ubuntu 22.04")]),s._v(" 初始化配置大家可以移步 "),a("a",{attrs:{href:"https://blog.striveonger.com/source/nodes/linux/node-vm_02.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("养成类虚拟机"),a("OutboundLink")],1),s._v(". 这里不再赘述了")]),s._v(" "),a("h3",{attrs:{id:"配置机器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置机器"}},[s._v("#")]),s._v(" 配置机器")]),s._v(" "),a("h4",{attrs:{id:"_1-hostname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-hostname"}},[s._v("#")]),s._v(" 1. hostname")]),s._v(" "),a("blockquote",[a("p",[s._v("分别在三台机器中执行")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 hostname")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" hostnamectl set-hostname master\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" hostnamectl set-hostname worker-1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" hostnamectl set-hostname worker-2\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 hostname")]),s._v("\nhostnamectl\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机名解析")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts")]),s._v("\n10.13.147.9   master\n10.13.147.10  worker-1\n10.13.147.11  worker-2\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" master\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" worker-1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" worker-2\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[s._v("系统")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("主机名")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("IP")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("内存")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("硬盘")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("Ubuntu 22.04")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("master")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("10.13.147.9")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("4G")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("20G")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("Ubuntu 22.04")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("worker-1")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("10.13.147.10")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("4G")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("20G")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("Ubuntu 22.04")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("worker-2")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("10.13.147.11")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("4G")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("20G")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("集群环境中, 需要用"),a("code",[s._v("hostname")]),s._v(" 来对机器做区分")])]),s._v(" "),a("h4",{attrs:{id:"_2-时钟同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-时钟同步"}},[s._v("#")]),s._v(" 2. 时钟同步")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新系统")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" upgrade\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置统一的东八区")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" timedatectl set-timezone Asia/Shanghai\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置时钟同步")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" chrony "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start chronyd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[s._v("集群环境中的必要工具")])]),s._v(" "),a("h3",{attrs:{id:"安装k3s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装k3s"}},[s._v("#")]),s._v(" 安装K3s")]),s._v(" "),a("h4",{attrs:{id:"_1-安装master节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装master节点"}},[s._v("#")]),s._v(" 1. 安装Master节点")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 安装K3s (使用ranher的镜像源来安装)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sfL")]),s._v(" https://rancher-mirror.rancher.cn/k3s/k3s-install.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_MIRROR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cn "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 验证")]),s._v("\nkubectl get nodes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_2-安装worker节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装worker节点"}},[s._v("#")]),s._v(" 2. 安装Worker节点")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Master节点上的Token信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/lib/rancher/k3s/server/node-token\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分别在 10.13.147.10, 10.13.147.11 执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sfL")]),s._v(" https://rancher-mirror.rancher.cn/k3s/k3s-install.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTALL_K3S_MIRROR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cn "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("K3S_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://10.13.147.9:6443"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("K3S_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"K10a3cd781cd276f13c7246df237a79ded6e47d1742957d2a18194920d1ffe71356::server:1203cc46f806dfffcb9a1edf40f14717"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("这里遇到的坑: 因为几台虚拟机都是从同一个模版创建出来的, 默认的"),a("code",[s._v("hostname")]),s._v("也是相同的. 导致 worker节点失败.")])]),s._v(" "),a("h4",{attrs:{id:"_3-安装k9s-可视化工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装k9s-可视化工具"}},[s._v("#")]),s._v(" 3. 安装K9s (可视化工具)")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -sS https://webinstall.dev/k9s | bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/derailed/k9s/releases/download/v0.50.4/k9s_linux_arm64.deb\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ./k9s_linux_arm64.deb\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制K3s配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/rancher/k3s/k3s.yaml ~/.kube/config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[s._v("这里遇到的坑: 默认是没有这个文件的 "),a("code",[s._v("~/.kube/config")]),s._v(",  K9s等客户端都要靠此文件 接入 kubernetes 集群, 所以这个文件是必须的")])]),s._v(" "),a("h4",{attrs:{id:"_4-安装-helm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装-helm"}},[s._v("#")]),s._v(" 4. 安装 Helm")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://baltocdn.com/helm/signing.asc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" gpg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dearmor")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /usr/share/keyrings/helm.gpg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" apt-transport-https "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [arch='),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("dpkg --print-architecture"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(' signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/helm-stable-debian.list\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" helm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_5-配置镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置镜像加速"}},[s._v("#")]),s._v(" 5. 配置镜像加速")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置k3s镜像拉取代理(三台机)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/rancher/k3s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /etc/rancher/k3s/registries.yaml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/rancher/k3s/registries.yaml")]),s._v('\nmirrors:\n  "docker.io":\n    endpoint:\n      - "https://registry.cn-hangzhou.aliyuncs.com"\n  "k8s.gcr.io":\n    endpoint:\n      - "https://registry.cn-hangzhou.aliyuncs.com/google_containers"\n  "quay.io":\n    endpoint:\n      - "https://quay.mirrors.ustc.edu.cn"\nEOF')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("blockquote",[a("p",[s._v("三台机器都要, 拉取镜像嘛.....")])]),s._v(" "),a("h3",{attrs:{id:"部署应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署应用"}},[s._v("#")]),s._v(" 部署应用")]),s._v(" "),a("h4",{attrs:{id:"_1-宿主机打包应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-宿主机打包应用"}},[s._v("#")]),s._v(" 1. 宿主机打包应用")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ci-cd/package/\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save striveonger/own-open-apis:1.0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" striveonger-own-open-apis.tar\n❯ ll\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("688528")]),s._v("\n-rw-r--r--  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" striveonger  staff   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".6K  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":25 own-open-apis-1.0.0.tgz\n-rw-------  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" striveonger  staff   336M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":32 striveonger-own-open-apis.tar\n-rw-r--r--  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" striveonger  staff   525B  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":25 values.yaml\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zcvf")]),s._v(" own-open-apis.tar package/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制到测试环境")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" own-open-apis.tar root@10.13.147.9:/root/development/workspace\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"_2-测试环境部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-测试环境部署"}},[s._v("#")]),s._v(" 2. 测试环境部署")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解包")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" development/workspace/\n❯ ll\ntotal 156M\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  156M May  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":53 own-open-apis.tar\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" own-open-apis.tar\n❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" package/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入镜像")]),s._v("\n❯ k3s ctr image delete docker.io/striveonger/own-open-apis:1.0.0\ndocker.io/striveonger/own-open-apis:1.0.0\n❯ k3s ctr image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" striveonger-own-open-apis.tar\ndocker.io/striveonger/own "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" apis:1.0.\tsaved\t\napplication/vnd.oci.image.manifest.v1+json sha256:0b8c86091ab1179e1eabaff213002011f1b934c156034502c8774453269b36ac\nImporting\telapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(" s\ttotal:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装应用")]),s._v("\n❯ helm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--install")]),s._v(" own-open-apis own-open-apis-1.0.0.tgz "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--values")]),s._v(" values.yaml "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" own "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--set")]),s._v(" app.config.applicationYaml.own.open-apis.storage.memory.max-rows"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nRelease "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"own-open-apis"')]),s._v(" has been upgraded. Happy Helming"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nNAME: own-open-apis\nLAST DEPLOYED: Fri May  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":24:15 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("\nNAMESPACE: own\nSTATUS: deployed\nREVISION: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nTEST SUITE: None\nNOTES:\nHelm chart "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("own-open-apis-1.0.0"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" success"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h3",{attrs:{id:"成果展示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#成果展示"}},[s._v("#")]),s._v(" 成果展示")]),s._v(" "),a("p",[a("img",{attrs:{src:t(545),alt:"image-20250509172716850"}})]),s._v(" "),a("blockquote",[a("p",[s._v("当然, 现在还是有问题的, 我只在 "),a("code",[s._v("master")]),s._v(" 节点导入了镜像. 如果Pod被调度到 "),a("code",[s._v("worker-*")]),s._v(" 节点, 会出现 "),a("code",[s._v("ImagePullError")]),s._v(" 的异常. 想要彻底解决这个问题, 就要引入 镜像私服 了...(诶嘿, 下期的选题这不就有了嘛~)")])])])}),[],!1,null,null,null);a.default=e.exports}}]);