(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{478:function(s,a,n){s.exports=n.p+"assets/img/image-20250512092712144.ee42e393.png"},479:function(s,a,n){s.exports=n.p+"assets/img/image-20250512144012599.5fc783d9.png"},480:function(s,a,n){s.exports=n.p+"assets/img/image-20250512145850348.773b2b96.png"},481:function(s,a,n){s.exports=n.p+"assets/img/image-20250512165144591.dad1c5f3.png"},482:function(s,a,n){s.exports=n.p+"assets/img/image-20250512171448602.c77819c4.png"},688:function(s,a,n){"use strict";n.r(a);var t=n(0),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("书接上回,  上次咱们将 "),a("code",[s._v("own-open-apis")]),s._v(" 项目, 部署到了 "),a("code",[s._v("Kubernetes")]),s._v(" 集群环境中. "),a("code",[s._v("worker-*")]),s._v(" 节点拉取镜像还会有问题...今天我们就来尝试解决一下这个问题")]),s._v(" "),a("p",[s._v("闲言少叙, 开始正文")]),s._v(" "),a("p",[s._v("我的思路是在宿主机上装个 "),a("code",[s._v("Harbor")]),s._v(" 完事了呗, 这样我想在集群环境中部署应用时, 就不用在往里面拷镜像了, 只需要同步 "),a("code",[s._v("Chart")]),s._v(" 包就可以了.")]),s._v(" "),a("p",[s._v("来, 看一下开始的效果是这样的 [捂脸]")]),s._v(" "),a("p",[a("img",{attrs:{src:n(478),alt:"image-20250512092712144"}})]),s._v(" "),a("h3",{attrs:{id:"安装私服"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装私服"}},[s._v("#")]),s._v(" 安装私服")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.下载helm-chart安装包")]),s._v("\n❯ helm pull oci://registry-1.docker.io/bitnamicharts/harbor "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.0")]),s._v(".1\nPulled: registry-1.docker.io/bitnamicharts/harbor:24.0.1\nDigest: sha256:f5622b24a26bf521d19b451e6f179603542658f509d3e3f01451af018ea2385f\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 安装 Harbor")]),s._v("\n❯ helm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" harbor harbor-24.0.1.tgz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" infrastructure --create-namespace "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("exposureType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ingress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ingress.core.tls")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ingress.core.selfSigned")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("adminPassword")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ePKfDkBHhfbhwH0JUxY2e8\nNAME: harbor\nLAST DEPLOYED: Mon May "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":33:42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("\nNAMESPACE: infrastructure\nSTATUS: deployed\nREVISION: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nTEST SUITE: None\nNOTES:\nCHART NAME: harbor\nCHART VERSION: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.0")]),s._v(".1\nAPP VERSION: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.11")]),s._v(".1\n\n** Please be patient "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" the chart is being deployed **\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Get the Harbor URL:\n\n  You should be able to access your new Harbor installation through https://core.harbor.domain\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". Login with the following credentials to see your Harbor application\n\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Username: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Password: "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" infrastructure harbor-core-envvars "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.HARBOR_ADMIN_PASSWORD}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n\n\n\nWARNING: There are "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resources"')]),s._v(" sections "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the chart not set. Using "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resourcesPreset"')]),s._v(" is not recommended "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" production. For production installations, please "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" the following values according to your workload needs:\n  - core.resources\n  - exporter.resources\n  - jobservice.resources\n  - nginx.resources\n  - portal.resources\n  - registry.controller.resources\n  - registry.server.resources\n  - trivy.resources\n+info https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("blockquote",[a("p",[s._v("注意: 这是在宿主机上哦~")])]),s._v(" "),a("p",[s._v("修改 "),a("code",[s._v("hosts")]),s._v(" 文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1 core.harbor.domain"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" /etc/hosts\n\n❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.zshrc\n\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nPING core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.040")]),s._v(" ms\n\n--- core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" packets received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.040")]),s._v("/0.040/0.040/0.000 ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("打开地址: https://core.harbor.domain/harbor/projects")]),s._v(" "),a("p",[a("img",{attrs:{src:n(479),alt:"image-20250512144012599"}})]),s._v(" "),a("blockquote",[a("p",[s._v("新建了个项目, 并改为公开")])]),s._v(" "),a("h3",{attrs:{id:"推送镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像"}},[s._v("#")]),s._v(" 推送镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新打包")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag striveonger/own-open-apis:1.0.0 core.harbor.domain/striveonger/own-open-apis:1.0.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录(反正是本地使用, 密码明文也无所谓了....)")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" admin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" ePKfDkBHhfbhwH0JUxY2e8\nWARNING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Using "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" via the CLI is insecure. Use --password-stdin.\nLogin Succeeded\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 向私服推送镜像")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push core.harbor.domain/striveonger/own-open-apis:1.0.0\nThe push refers to repository "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("core.harbor.domain/striveonger/own-open-apis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndb5dd49de3f2: Pushed \ncff61dad21a4: Pushed \nd84b4d03bebc: Pushed \na6018fb8972b: Pushed \n5e97e47c11c1: Pushed \n3aba462813f2: Pushed \nde085928b8c4: Pushed \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0: digest: sha256:a8abb93724c26480e59329ef6d6e148c317ff532ad38e58cae18a5c4ba7a7674 size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1786")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("推送成功~")]),s._v(" "),a("p",[a("img",{attrs:{src:n(480),alt:"image-20250512145850348"}})]),s._v(" "),a("h3",{attrs:{id:"配置私服"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置私服"}},[s._v("#")]),s._v(" 配置私服")]),s._v(" "),a("p",[s._v("在集群环境中配置镜像私服")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 三台虚拟机都要执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 配置域名")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.13.147.1 core.harbor.domain"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" /etc/hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 测试是否配置成功")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nPING core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.13")]),s._v(".147.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.13")]),s._v(".147.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.189")]),s._v(" ms\n\n--- core.harbor.domain "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" packets transmitted, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" received, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 0ms\nrtt min/avg/max/mdev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.189")]),s._v("/0.189/0.189/0.000 ms\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 修改前")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/rancher/k3s/registries.yaml \nmirrors:\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker.io"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    endpoint:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.cn-hangzhou.aliyuncs.com"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s.gcr.io"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    endpoint:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.cn-hangzhou.aliyuncs.com/google_containers"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quay.io"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    endpoint:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://quay.mirrors.ustc.edu.cn"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 修改文件内容")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'/"docker.io":/,/endpoint:/ {\n    /endpoint:/ {\n        n\n        i\\      - "https://core.harbor.domain"\n    }\n}\'')]),s._v(" /etc/rancher/k3s/registries.yaml \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 修改后")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/rancher/k3s/registries.yaml \nmirrors:\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker.io"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    endpoint:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://core.harbor.domain"')]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.cn-hangzhou.aliyuncs.com"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s.gcr.io"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    endpoint:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.cn-hangzhou.aliyuncs.com/google_containers"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quay.io"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    endpoint:\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://quay.mirrors.ustc.edu.cn"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("h4",{attrs:{id:"配置tls证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置tls证书"}},[s._v("#")]),s._v(" 配置TLS证书")]),s._v(" "),a("p",[s._v("下载证书")]),s._v(" "),a("p",[a("img",{attrs:{src:n(481),alt:"image-20250512165144591"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 宿主机 SCP")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" ./harbor-ca.crt root@10.13.147.9:/root\nharbor-ca.crt                             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1127")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9MB/s   00:00    \n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" ./harbor-ca.crt root@10.13.147.10:/root\nharbor-ca.crt                             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1127")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".4MB/s   00:00    \n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" ./harbor-ca.crt root@10.13.147.11:/root\nharbor-ca.crt                             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1127")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".4MB/s   00:00    \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟机添加信任证书 (三台机器)")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" harbor-ca.crt /usr/local/share/ca-certificates/\n❯  ll /usr/local/share/ca-certificates/\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2K May "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":58 harbor-ca.crt\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" update-ca-certificates\nUpdating certificates "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /etc/ssl/certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nrehash: warning: skipping ca-certificates.crt,it does not contain exactly one certificate or CRL\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" added, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" removed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" done.\nRunning hooks "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /etc/ca-certificates/update.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndone.\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Containerd添加信任证书")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/containerd/certs.d/core.harbor.domain\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" harbor-ca.crt /etc/containerd/certs.d/core.harbor.domain/ca.crt\n❯ ll /etc/containerd/certs.d/core.harbor.domain/\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2K May "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":05 ca.crt\n\n\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart containerd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若使用K3s，重启K3s服务")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart k3s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h3",{attrs:{id:"成果展示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#成果展示"}},[s._v("#")]),s._v(" 成果展示")]),s._v(" "),a("p",[a("img",{attrs:{src:n(482),alt:"image-20250512171448602"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);