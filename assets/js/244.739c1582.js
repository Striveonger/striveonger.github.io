(window.webpackJsonp=window.webpackJsonp||[]).push([[244],{806:function(s,a,n){"use strict";n.r(a);var t=n(0),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("基于 ansible-role 实现node-exporter的安装")]),s._v(" "),a("h3",{attrs:{id:"_1-初始化机器环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化机器环境"}},[s._v("#")]),s._v(" 1. 初始化机器环境")]),s._v(" "),a("h4",{attrs:{id:"_1-1-去掉目标机器的网关规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-去掉目标机器的网关规则"}},[s._v("#")]),s._v(" 1.1 去掉目标机器的网关规则")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --list-port")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9100")]),s._v("/tcp\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --remove-port=9100/tcp")]),s._v("\nsuccess\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_1-2-在控制面安装ansible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-在控制面安装ansible"}},[s._v("#")]),s._v(" 1.2 在控制面安装ansible")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ tree ansible\nansible\n├── amd64\n│   ├── ansible-core_2.14.3-1_all.deb\n│   ├── ca-certificates_20230311_all.deb\n│   ├── ieee-data_20220827.1_all.deb\n│   ├── libbsd0_0.11.7-2_amd64.deb\n│   ├── libcbor0.8_0.8.0-2+b1_amd64.deb\n│   ├── libcom-err2_1.47.0-2_amd64.deb\n│   ├── libedit2_3.1-20221030-2_amd64.deb\n│   ├── libexpat1_2.5.0-1_amd64.deb\n│   ├── libfido2-1_1.12.0-2+b1_amd64.deb\n│   ├── libgssapi-krb5-2_1.20.1-2+deb12u2_amd64.deb\n│   ├── libk5crypto3_1.20.1-2+deb12u2_amd64.deb\n│   ├── libkeyutils1_1.6.3-2_amd64.deb\n│   ├── libkrb5-3_1.20.1-2+deb12u2_amd64.deb\n│   ├── libkrb5support0_1.20.1-2+deb12u2_amd64.deb\n│   ├── libncursesw6_6.4-4_amd64.deb\n│   ├── libnsl2_1.3.0-2_amd64.deb\n│   ├── libpsl5_0.21.2-1_amd64.deb\n│   ├── libpython3-stdlib_3.11.2-1+b1_amd64.deb\n│   ├── libpython3.11-minimal_3.11.2-6+deb12u2_amd64.deb\n│   ├── libpython3.11-stdlib_3.11.2-6+deb12u2_amd64.deb\n│   ├── libreadline8_8.2-1.3_amd64.deb\n│   ├── libsqlite3-0_3.40.1-2_amd64.deb\n│   ├── libssl3_3.0.13-1~deb12u1_amd64.deb\n│   ├── libtirpc-common_1.3.3+ds-1_all.deb\n│   ├── libtirpc3_1.3.3+ds-1_amd64.deb\n│   ├── libyaml-0-2_0.2.5-1_amd64.deb\n│   ├── media-types_10.0.0_all.deb\n│   ├── netbase_6.4_all.deb\n│   ├── openssh-client_1%3a9.2p1-2+deb12u3_amd64.deb\n│   ├── openssl_3.0.13-1~deb12u1_amd64.deb\n│   ├── python3-cffi-backend_1.15.1-5+b1_amd64.deb\n│   ├── python3-cryptography_38.0.4-3_amd64.deb\n│   ├── python3-distutils_3.11.2-3_all.deb\n│   ├── python3-dnspython_2.3.0-1_all.deb\n│   ├── python3-httplib2_0.20.4-3_all.deb\n│   ├── python3-jinja2_3.1.2-1_all.deb\n│   ├── python3-lib2to3_3.11.2-3_all.deb\n│   ├── python3-markupsafe_2.1.2-1+b1_amd64.deb\n│   ├── python3-minimal_3.11.2-1+b1_amd64.deb\n│   ├── python3-netaddr_0.8.0-2_all.deb\n│   ├── python3-packaging_23.0-1_all.deb\n│   ├── python3-pycryptodome_3.11.0+dfsg1-4_amd64.deb\n│   ├── python3-pyparsing_3.0.9-1_all.deb\n│   ├── python3-resolvelib_0.9.0-2_all.deb\n│   ├── python3-yaml_6.0-3+b2_amd64.deb\n│   ├── python3.11-minimal_3.11.2-6+deb12u2_amd64.deb\n│   ├── python3.11_3.11.2-6+deb12u2_amd64.deb\n│   ├── python3_3.11.2-1+b1_amd64.deb\n│   ├── readline-common_8.2-1.3_all.deb\n│   ├── sshpass_1.09-1+b1_amd64.deb\n│   └── wget_1.21.3-1+b2_amd64.deb\n├── ansible.cfg\n├── arm64\n│   ├── ansible-core_2.14.3-1_all.deb\n│   ├── ca-certificates_20230311_all.deb\n│   ├── ieee-data_20220827.1_all.deb\n│   ├── libbsd0_0.11.7-2_arm64.deb\n│   ├── libcbor0.8_0.8.0-2+b1_arm64.deb\n│   ├── libcom-err2_1.47.0-2_arm64.deb\n│   ├── libedit2_3.1-20221030-2_arm64.deb\n│   ├── libexpat1_2.5.0-1_arm64.deb\n│   ├── libfido2-1_1.12.0-2+b1_arm64.deb\n│   ├── libgssapi-krb5-2_1.20.1-2+deb12u2_arm64.deb\n│   ├── libk5crypto3_1.20.1-2+deb12u2_arm64.deb\n│   ├── libkeyutils1_1.6.3-2_arm64.deb\n│   ├── libkrb5-3_1.20.1-2+deb12u2_arm64.deb\n│   ├── libkrb5support0_1.20.1-2+deb12u2_arm64.deb\n│   ├── libncursesw6_6.4-4_arm64.deb\n│   ├── libnsl2_1.3.0-2_arm64.deb\n│   ├── libpsl5_0.21.2-1_arm64.deb\n│   ├── libpython3-stdlib_3.11.2-1+b1_arm64.deb\n│   ├── libpython3.11-minimal_3.11.2-6+deb12u2_arm64.deb\n│   ├── libpython3.11-stdlib_3.11.2-6+deb12u2_arm64.deb\n│   ├── libreadline8_8.2-1.3_arm64.deb\n│   ├── libsqlite3-0_3.40.1-2_arm64.deb\n│   ├── libssl3_3.0.13-1~deb12u1_arm64.deb\n│   ├── libtirpc-common_1.3.3+ds-1_all.deb\n│   ├── libtirpc3_1.3.3+ds-1_arm64.deb\n│   ├── libyaml-0-2_0.2.5-1_arm64.deb\n│   ├── media-types_10.0.0_all.deb\n│   ├── netbase_6.4_all.deb\n│   ├── openssh-client_1%3a9.2p1-2+deb12u3_arm64.deb\n│   ├── openssl_3.0.13-1~deb12u1_arm64.deb\n│   ├── python3-cffi-backend_1.15.1-5+b1_arm64.deb\n│   ├── python3-cryptography_38.0.4-3_arm64.deb\n│   ├── python3-distutils_3.11.2-3_all.deb\n│   ├── python3-dnspython_2.3.0-1_all.deb\n│   ├── python3-httplib2_0.20.4-3_all.deb\n│   ├── python3-jinja2_3.1.2-1_all.deb\n│   ├── python3-lib2to3_3.11.2-3_all.deb\n│   ├── python3-markupsafe_2.1.2-1+b1_arm64.deb\n│   ├── python3-minimal_3.11.2-1+b1_arm64.deb\n│   ├── python3-netaddr_0.8.0-2_all.deb\n│   ├── python3-packaging_23.0-1_all.deb\n│   ├── python3-pycryptodome_3.11.0+dfsg1-4_arm64.deb\n│   ├── python3-pyparsing_3.0.9-1_all.deb\n│   ├── python3-resolvelib_0.9.0-2_all.deb\n│   ├── python3-yaml_6.0-3+b2_arm64.deb\n│   ├── python3.11-minimal_3.11.2-6+deb12u2_arm64.deb\n│   ├── python3.11_3.11.2-6+deb12u2_arm64.deb\n│   ├── python3_3.11.2-1+b1_arm64.deb\n│   ├── readline-common_8.2-1.3_all.deb\n│   ├── sshpass_1.09-1_arm64.deb\n│   └── wget_1.21.3-1+b1_arm64.deb\n└── collections\n    ├── ansible-posix-1.5.4.tar.gz\n    ├── community-general-9.1.0.tar.gz\n    ├── kubernetes-core-2.4.2.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $TARGETARCH 当前服务器的CPU架构 amd64 or arm64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装ansible的基础环境")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ansible/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TARGETARCH")]),s._v("/*.deb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" clean "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /var/lib/apt/lists/*\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装ansible额外的扩展 module")]),s._v("\n❯ ansible-galaxy collection "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" /opt/ansible/collections/*.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置ansible")]),s._v("\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ansible/ansible.cfg /etc/ansible/ansible.cfg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br")])]),a("h3",{attrs:{id:"_2-内容解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-内容解析"}},[s._v("#")]),s._v(" 2. 内容解析")]),s._v(" "),a("h4",{attrs:{id:"_2-1-ansible-cfg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-ansible-cfg"}},[s._v("#")]),s._v(" 2.1 ansible.cfg")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("defaults")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("nocows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("True")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("roles_path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/opt/ops/remote-deploy/roles")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("remote_tmp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("$HOME/.ansible/tmp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("local_tmp")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("$HOME/.ansible/tmp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("pipelining")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("True")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("become")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("True")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("host_key_checking")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("False")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("deprecation_warnings")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("False")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("callback_whitelist")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("profile_tasks")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("inventory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("enable_plugins")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("host_list, script, auto, yaml, ini, toml")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"_2-2-remote-deploy-目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-remote-deploy-目录结构"}},[s._v("#")]),s._v(" 2.2 remote-deploy 目录结构")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ tree remote-deploy/\nremote-deploy/\n├── deploys\n│   ├── inventorys\n│   │   └── example-inventory\n│   └── playbooks\n│       ├── install-node-exporter.yaml\n│       └── ping.yaml\n└── roles                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- 可执行的roles\n    └── node-exporter-role\n        ├── README.md\n        ├── defaults                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- 定义任务执行的默认值\n        │   └── main.yml\n        ├── files                                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- 存放任务执行所需的文件\n        │   ├── node_exporter-1.6.0.linux-amd64\n        │   │   ├── NOTICE\n        │   │   └── node_exporter\n        │   └── node_exporter-1.6.0.linux-arm64\n        │       ├── NOTICE\n        │       └── node_exporter\n        ├── handlers\n        │   └── main.yml\n        ├── meta\n        │   └── main.yml\n        ├── molecule\n        │   └── default\n        │       ├── converge.yml\n        │       └── molecule.yml\n        ├── tasks                                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- 定义具体的执行任务\n        │   ├── config-version.yaml\n        │   ├── enable-port.yaml\n        │   └── main.yml\n        └── templates                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- 存放任务所需的模版文件\n            └── node_exporter.service.j2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("h4",{attrs:{id:"_2-3-解析role目录-defaults-main-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-解析role目录-defaults-main-yml"}},[s._v("#")]),s._v(" 2.3 解析role目录 (defaults/main.yml)")]),s._v(" "),a("blockquote",[a("p",[s._v("定义一些任务执行所需的变量")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use the latest node_exporter release  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.6.0'")]),s._v("  \n  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alternatively, set a specific version  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See available releases: https://github.com/prometheus/node_exporter/releases/  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node_exporter_version: '0.18.1'  ")]),s._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_arch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'arm64'")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node_exporter_download_url: https://github.com/prometheus/node_exporter/releases/download/v{{ node_exporter_version }}/node_exporter-{{ node_exporter_version }}.linux-{{ node_exporter_arch }}.tar.gz  ")]),s._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_bin_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/local/bin/node_exporter  \n  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set node_exporter_host to localhost if you wish to expose node_exporter on localhost only.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9100")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("  \n  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" started  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"_2-4-解析role目录-tasks-main-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-解析role目录-tasks-main-yml"}},[s._v("#")]),s._v(" 2.4 解析role目录 (tasks/main.yml)")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Check current node_exporter version.  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ node_exporter_bin_path }} --version"')]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failed_when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("changed_when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter_version_check  \n  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - name: Configure latest version  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   include_tasks: config-version.yaml  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   when: >  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     node_exporter_version is match("latest")  ')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     or node_exporter_version is not defined  ")]),s._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - name: Get target machine architecture  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   ansible.builtin.command: uname -m  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   register: machine_arch  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   changed_when: false  ")]),s._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Set node_exporter_arch based on machine architecture  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ansible.builtin.set_fact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter_arch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("  \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" if ansible_architecture == 'x86_64' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("amd64  \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" elif ansible_architecture == 'aarch64' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("arm64  \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" else "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_architecture "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" endif "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Copy node_exporter binary from files folder  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_exporter-{{ node_exporter_version }}.linux-{{ node_exporter_arch | trim }}/node_exporter"')]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ node_exporter_bin_path }}"')]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0755")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("  \n    node_exporter_version_check.stdout is not defined  \n    or node_exporter_version not in node_exporter_version_check.stdout  ")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart node_exporter  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create node_exporter user.  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /sbin/nologin  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Copy the node_exporter systemd unit file.  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter.service.j2  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/systemd/system/node_exporter.service  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0644")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter_service  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Reload systemd daemon if unit file is changed.  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("systemd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("daemon_reload")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  notify: restart node_exporter  ")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" systemctl restart node_exporter.service  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter_service is changed  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ensure node_exporter is running and enabled at boot.  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ node_exporter_state }}"')]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ node_exporter_enabled }}"')]),s._v("  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Verify node_exporter is responding to requests.  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"http://{% if node_exporter_host !='' %}{{ node_exporter_host }}{% else %}localhost{% endif %}:{{ node_exporter_port }}/\"")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("return_content")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics_output  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failed_when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"'Metrics' not in metrics_output.content\"")]),s._v("  \n  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gather service facts  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ansible.builtin.service_facts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Enable node_exporter port  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("firewalld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 9100/tcp  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("permanent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" enabled  \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("immediate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ansible_facts.services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firewalld.service'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'state'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" == 'running'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br")])]),a("h4",{attrs:{id:"_2-5-解析role目录-templates-node-exporter-service-j2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-解析role目录-templates-node-exporter-service-j2"}},[s._v("#")]),s._v(" 2.5 解析role目录 (templates/node_exporter.service.j2)")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \nDescription=NodeExporter  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \nTimeoutStartSec=0  \nUser=node_exporter  \nExecStart="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node_exporter_bin_path "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web.listen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node_exporter_host "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node_exporter_port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node_exporter_options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \nRestart="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node_exporter_restart "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \nWantedBy=multi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"_2-6-stall-node-exporter-yaml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-stall-node-exporter-yaml"}},[s._v("#")]),s._v(" 2.6 stall-node-exporter.yaml")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" servers\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" roles/node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_2-7-example-inventory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-example-inventory"}},[s._v("#")]),s._v(" 2.7 example-inventory")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("servers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \n10.40.10.8 ansible_ssh_host=10.40.10.8 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_password=root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_3-执行ansible-playbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-执行ansible-playbook"}},[s._v("#")]),s._v(" 3. 执行ansible-playbook")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" remote-deploy\n❯ ll\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ndrwxr-xr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" striveonger  staff   128B  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":32 deploys\ndrwxr-xr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" striveonger  staff    96B  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":32 roles\n❯ ansible-playbook deploys/playbooks/install-node-exporter.yaml --inventory-file deploys/inventorys/example-inventory\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);